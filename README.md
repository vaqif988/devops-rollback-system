üöÄ DevOps Rollback System

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CI-–ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞ –∏ –º–µ—Ö–∞–Ω–∏–∑–º —Ä—É—á–Ω–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ (rollback) –¥–æ –ª—é–±–æ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏.

üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã DevOps-–ø–∞–π–ø–ª–∞–π–Ω–∞:

CI/CD:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ –≤–µ—Ç–∫—É main.

–ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞ –≤ Docker Hub.

–†—É—á–Ω–æ–π Rollback:

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –ª—é–±–æ–π –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—è GitHub Actions.

Rollback –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Helm chart (–∏–ª–∏ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–µ–ø–ª–æ—è).

–£–±—Ä–∞–Ω–æ:

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ Kubernetes (—É–¥–∞–ª—ë–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä).

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è DevOps-–ø—Ä–æ—Ü–µ—Å—Å–∞–º –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ CI/CD + Rollback –∫–æ–Ω—Ü–µ–ø—Ü–∏–π.

üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
.
‚îú‚îÄ‚îÄ app/                     # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Dockerfile               # Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ helm/
‚îÇ   ‚îî‚îÄ‚îÄ myapp/               # Helm chart –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ deploy.yml       # CI: Build & Push Docker Image
‚îÇ       ‚îî‚îÄ‚îÄ rollback.yml     # –†—É—á–Ω–æ–π rollback
‚îî‚îÄ‚îÄ README.md

‚öôÔ∏è CI: Build & Push Docker Image

–ü—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ main –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow:

.github/workflows/deploy.yml

–§—É–Ω–∫—Ü–∏–∏:

Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

–õ–æ–≥–∏–Ω –≤ Docker Hub (secrets)

–°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞

–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Docker Hub —Å –¥–≤—É–º—è —Ç–µ–≥–∞–º–∏:

latest

<commit_sha>

üîê –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã:
Secret	–û–ø–∏—Å–∞–Ω–∏–µ
REGISTRY_USER	–õ–æ–≥–∏–Ω Docker Hub
REGISTRY_PASSWORD	–ü–∞—Ä–æ–ª—å Docker Hub
üîÑ Rollback Workflow

Rollback –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub Actions.

.github/workflows/rollback.yml

–§—É–Ω–∫—Ü–∏–∏:

–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –∏–∑ Docker Hub
(—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –ª—é–±–æ–π –∏–∑ –Ω–∏—Ö)

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–µ–≥–∞:

–û–±–Ω–æ–≤–ª—è–µ—Ç –æ–±—Ä–∞–∑ –≤ Helm chart

–ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ)

üëâ –í–∞–∂–Ω–æ:
–í —ç—Ç–æ–º —É—á–µ–±–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ Kubernetes –¥–µ–ø–ª–æ–π –æ—Ç–∫–ª—é—á—ë–Ω, —á—Ç–æ–±—ã –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å –æ–ø–ª–∞—á–∏–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä.
–ù–æ –º–µ—Ö–∞–Ω–∏–∑–º rollback –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π ‚Äî –æ–Ω –≤—ã–≤–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Helm-–∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

üöÄ –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å Rollback

–ü–µ—Ä–µ–π—Ç–∏ –≤ GitHub ‚Üí Actions

–í—ã–±—Ä–∞—Ç—å workflow Auto Rollback

–ù–∞–∂–∞—Ç—å Run workflow

–í –ø–æ–ª–µ –≤–≤–æ–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–≥ Docker Hub, –Ω–∞–ø—Ä–∏–º–µ—Ä:

55309aa178d5fceaa9c0997


–ù–∞–∂–∞—Ç—å Run workflow

Workflow —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç –æ—Ç–∫–∞—Ç (–∏–ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—É –¥–ª—è helm deploy).

üê≥ –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–≥–∏?

–¢–µ–≥–∏ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —Å—é–¥–∞:

üëâ https://hub.docker.com/repository/docker/vaqif/myapp/tags

–ù–∞ –∫–∞–∂–¥—ã–π push —Å–æ–∑–¥–∞—é—Ç—Å—è:

latest

<hash_commit'–∞>

üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ—Ç –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

–í –ø—Ä–æ–µ–∫—Ç —Ä–∞–Ω–µ–µ –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª minikube-linux-amd64 (>100 MB), —á—Ç–æ –≤—ã–∑–≤–∞–ª–æ –æ—à–∏–±–∫—É GitHub.
–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Ä–µ—à–µ–Ω–∞:

—Ñ–∞–π–ª —É–¥–∞–ª—ë–Ω –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥–æ–π git filter-repo

—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞–Ω

.gitignore –æ–±–Ω–æ–≤–ª—ë–Ω

main –≤–µ—Ç–∫–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω–∞

‚úî –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è	–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Docker	–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤
Docker Hub	–•—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
GitHub Actions	CI/CD, rollback
Helm	–®–∞–±–ª–æ–Ω—ã –¥–ª—è –¥–µ–ø–ª–æ—è
YAML	–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ pipeline'–æ–≤
üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ:

docker build -t myapp:latest .


–ó–∞–ø—É—Å—Ç–∏—Ç—å:

docker run -p 8080:8080 myapp


–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–≥–∏ –≤ Docker Hub:

curl -s https://hub.docker.com/v2/repositories/vaqif/myapp/tags

üèÅ –ò—Ç–æ–≥

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

‚úî –ü–æ–ª–Ω—ã–π CI-–ø—Ä–æ—Ü–µ—Å—Å
‚úî –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π rollback
‚úî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Docker Hub
‚úî –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–¥–µ–ø–ª–æ—é (–ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞)

–û–Ω –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:

–∫–∞–∫ —É—á–µ–±–Ω—ã–π DevOps –ø—Ä–æ–µ–∫—Ç

–∫–∞–∫ —á–∞—Å—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ

–∫–∞–∫ –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞
